![斑马](https://img-blog.csdnimg.cn/20200911173646510.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dhbmRvdTk1Mjc=,size_16,color_FFFFFF,t_70#pic_center)

varchar存储MySQL字符串类型数据。
本文基于MySQL 5.7x

### varchar有以下特点：
- MySQL规定：一行数据的最大长度是65535字节，注意，是字节（byte），text、blob等大字段类型除外。
- varchar的存储需要单独记录其长度，是在列之外占用的空间，但包括在每行总字节数限制内。
- 占用空间和使用字符集相关
    - gbk（每字符占用2字节）
    - utf8（每字符占用3字节）
    - utf8mb4（每字符占用4字节）

### 为什么是 varchar(255)？
以varchar(255)为例，这里的255表示字符数，假设字符集是utf8，那么存储汉字占用的字节数是255*3=765。那么为什么我们看到有很多情况数据库里的varchar字段长度是255呢？

每个业务场景可能有特定的原因，但是设置为255有一些优点：
- 在utf8字符集下，每个字符占3字节。
- mysql innodb引擎的每个索引列长度限制为767字节（bytes），255*3=765，255恰好是不超过索引长度限制的最大长度。
- 节省1byte空间。varchar字段需要单独记录其长度，1byte(8bit)无符号可表示的最大数是2^8-1=255，如果超过255（小于512）则需要多申请1byte来记录字段长度。

### 该用char还是varchar？
char：定长字符串
varchar：可变长字符串
char和varchar区别，以char(32)和varchar(32)举例：

|                  | char(32)                                                     | varchar(32)                                |
| ---------------- | ------------------------------------------------------------ | ------------------------------------------ |
| 占用空间         | 固定32字符[^1]（如果数据长度不够32将用空格补齐）             | 跟随实际存储内容长度，但不超过32           |
| 空格处理         | 检索时会去掉尾部空格（数据本身有空白符也会被去掉）           | 不会对空格处理                             |
| 是否记录字段长度 | 否                                                           | 是。额外拿出空间记录字段数据长度（字符数） |
| 适用场景         | 存储的数据长度基本一致，不需要空格，eg 手机号、UUID、密码加密后的密文 | 数据长度不一定，长度范围变化较大的场景     |
[^1]: 占用空间需根据字符集转换为字节，以utf8为例，每字符占3字节。 

![cherry-105141_1280](/Users/liming/Downloads/cherry-105141_1280.png)

